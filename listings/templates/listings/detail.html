{% extends "base.html" %}
{% block content %}
<div id="wrapper">
  <div id="page">
    <div id="page-bgtop">
      <div id="page-bgbtm">
        
        <div id="content">
          <div class="post">
            <h2 class="title">{{ listing.title }} 
            {% if listing.finished %} (Completed) {% endif %}</h2>
            <p class="meta"><span class="date"> Updated {{ listing.date_posted }}</span><span class="posted">Posted by {{ listing.owner.get_full_name }}, <em>{{ listing.owner.get_major_display }}</em></span></p>
            <div style="clear: both;">&nbsp;</div>
            <div class="entry">
              <p><em>Category:
              {% for category in listing.category.all %}
                {{ category.name }},
              {% endfor %}
              </em></p>
              {{ listing.description }}
            </div>
          </div>
          <div style="clear: both;">&nbsp;</div>
        </div>
        <div id="sidebar">
          <ul>
            {% if user.is_authenticated %}
            {% if showedit %}
            <li>
              <a href="{% url 'edit' listing.pk %}" class="button">Edit Project</a>
            <li>
            <br>
            <li>
              {% if listing.finished %}
                <a href="{% url 'flip_finished' listing.pk %}" class="button">Un-Complete Project</a>
              {% else %}
                <a href="{% url 'flip_finished' listing.pk %}" class="button">Complete Project</a>
              {% endif %}
            <li>
              <div style="clear: both;">&nbsp;</div>
            </li>
            {% elif not listing.finished and canjoin %}
            <li>
              <a id="join-project-button" class="button">Join Project</a>
              <form id="join-project-form" method="post">
                {% csrf_token %}
                {{ form }}
                <input type="submit" value="Submit" />
              </form>
              {% if form_success %}You submitted the request successfully{%endif%}
              {% if not form_errors %}<script>$("#join-project-form").hide();</script>{%endif%}
              <div style="clear: both;">&nbsp;</div>
              <script>
                $("#join-project-button").click(function() {
                  $("#join-project-form").show();
                });
              </script>
            </li>
            {% elif not listing.finished %}
            <li>
            You have already submitted a request to join this team or are part of this team!
            </li>
            {% endif %}
            {% endif %}
            <li>
              <h2>Needs:</h2>
              <ul>
                {% for skill in listing.skill.all %}
                  <li>{{ skill.name }}</li>
                {% endfor %}
              </ul>
            </li>
            <li>
              <h2>Team Members:</h2>
              <ul>
                {% for user in listing.team.all %}
                  <li>{{user.get_full_name}}, <em>{{user.get_major_display}}</em></li>
                {% endfor %}
              </ul>
            </li>
            <li>
              <h2>Project Type:</h2>
              <ul>
                <li>{{ listing.get_project_type_display }}</li>
              </ul>
            </li>
            <li>
              <h2>Poster Type:</h2>
              <ul>
                <li>{{ listing.get_poster_type_display }}</li>
              </ul>
            </li>
            <li>
            {% if listing.sponsored %} 
              <h2><em>(Sponsored)</em></h2>
            {% endif %}
            </li>
          </ul>
        </div>
        <div style="clear: both;">&nbsp;</div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
